/*! Compiled on: 2014-06-05 */
"use strict";define(["angular","utils/dependcyManager","angular-resource","cookies","angular-seo","angular-route","angular-sanitize","angular-animate","angular-ui-router","modal","facebook","analytics"],function(angular){var app=angular.module("app",["ngResource","ngRoute","ui.router","cookies","ngSanitize","ngAnimate","seo","ui.modal","analytics"],function($compileProvider,$controllerProvider,$provide,$filterProvider){app.decoratorManager=$provide.decorator,app.factoryManager=$provide.factory,app.filterManager=$filterProvider.register,app.directiveManager=$compileProvider.directive,app.compileManager=$compileProvider,app.controllerManager=$controllerProvider.register,app.constantManager=$provide.constant,app.controllerManager("app",["$rootScope","$state","$location","$injector","$cookies","$analytics",function($rootScope,$state,$location,$injector,$cookies){$cookies.has("guestCount")||$cookies.set("guestCount",120),$rootScope.couplesHost=$location.host().replace("venues.",""),$rootScope.guestCount=$cookies.get("guestCount"),require(["authenticationFactory"],function(){var authenticationFactory=$injector.get("authenticationFactory");$rootScope.loggedIn=!1,authenticationFactory.on("authentication",function(authenticated){$rootScope.loggedIn="loggedin"==authenticated?!0:!1})}),$rootScope.$on("$stateChangeStart",function(event,toState){$rootScope.css=toState.data.css}),$rootScope.$on("$stateChangeSuccess",function(){$rootScope.loaded=!0,$rootScope.views={};var defaultViews={search:!1,footer:!0,receptions:!1,layouts:!1,guests:!1,showVenueSignup:!0},views="undefined"!=typeof $state.current.data.views?$state.current.data.views:defaultViews;$rootScope.views.search="undefined"!=typeof views.search?views.search:defaultViews.search,$rootScope.views.footer="undefined"!=typeof views.footer?views.footer:defaultViews.footer,$rootScope.views.receptions="undefined"!=typeof views.receptions?views.receptions:defaultViews.receptions,$rootScope.views.layouts="undefined"!=typeof views.layouts?views.layouts:defaultViews.layouts,$rootScope.views.guests="undefined"!=typeof views.guests?views.guests:defaultViews.guests,$rootScope.views.showVenueSignup="undefined"!=typeof views.showVenueSignup?views.showVenueSignup:defaultViews.showVenueSignup,"undefined"!=typeof $state.current.data.class&&($rootScope.uiState=$state.current.data.class),"undefined"!=typeof $state.current.data.title&&($rootScope.title=$state.current.data.title),"undefined"!=typeof $state.current.data.description&&($rootScope.description=$state.current.data.description);var path=$location.path();return"/"===path.charAt(path.length-1)?path.substr(0,path.length-1):($(window).bind("resize",function(){$rootScope.windowWidth=$(document).width()}),void ga("send","pageview",$location.url()))})}])});return app.constant("config",{api:"http://api."+window.location.host.replace("venues.","")+"/v1",host:"http://"+window.location.host.replace("venues.",""),stripe:"pk_test_SpVvkISWMgcCnztxXYBOFbRf",dbVersion:14}),FB.init({appId:"537217406358458",channelUrl:"//thehitch.com/channel.html"}),app.config(function($httpProvider){var authHttpInterceptor=["$q","$injector","$cookies","$rootScope",function($q,$injector,$cookies){var refreshAccessToken=function(){var deferred=$q.defer();return require(["authenticationFactory"],function(){var authenticationFactory=$injector.get("authenticationFactory");authenticationFactory.refreshAccessToken().then(function(){deferred.resolve()},function(){deferred.reject()})}),deferred.promise};return{request:function(config){return config.authentication===!0&&$cookies.has("token_expiry")&&$cookies.has("refresh_token")&&$cookies.has("access_token")?Math.round((new Date).getTime()/1e3)>$cookies.get("token_expiry")?refreshAccessToken().then(function(){return config.headers.Authorization=$cookies.get("access_token"),config}):(config.headers.Authorization=$cookies.get("access_token"),config):config.authentication===!0?config||$q.when(config):config||$q.when(config)}}}];$httpProvider.interceptors.push(authHttpInterceptor)}),app});